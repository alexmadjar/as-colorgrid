
<html>
  <head>
    <meta charset="utf-8">
    <title>Color Grid</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.js"></script>
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.12.min.js"></script>
    <script type="text/javascript" src="uri.js"></script>
    <script type="text/javascript">
      var WHITE = 'rgb(255, 255, 255)';
      Parse.initialize('pryvUUiLmHRSIuAXpkYZufyocEDmYYtCLiKsgveu', '20pJ8dbgKgriZeHMlcELf3VC2nln0ii0bwtdJqxO');
      var Board = Parse.Object.extend('Board');

      function randByte() {
        return Math.floor(Math.random() * 256);
      }
      function randomColor() {
        return 'rgb('+randByte()+', '+randByte()+', '+randByte()+')';
      }
      function handleCellClick(e) {
        var cell = $(e.srcElement);
        if (cell.css('background-color') == WHITE) {
          cell.css('background-color', randomColor());
        } else {
          cell.css('background-color', WHITE);
        }
      }
      function handleReset(e) {
        var form = $(e.srcElement);
        $('#thetable').empty();
        var height = parseInt(form.find('[name=height]').val());
        var width = parseInt(form.find('[name=width]').val());
        if (!height || !width || width < 0 || height < 0) {
          alert('Don\'t be a poop: enter positive numbers!');
          return false;
        }
        for (var y = height - 1; y >= 0; y--) {
          var row = '';
          for (var x = width - 1; x >= 0; x--) {
            row += '<td style="background-color: white" onClick="return handleCellClick(event)"></td>';
          }
          $('#thetable').append('<tr>'+row+'</tr>');
        }
        return false;
      }
      function saveBoard(e) {
        var rows = 0;
        var colors = [];
        $('#thetable').children('tbody').children('tr').each(function (index) {
          rows++;
          $(this).children('td').each(function (i) {
            colors.push($(this).css('background-color'));
          });
        });
        var board = {
          x: colors.length / rows,
          y: rows,
          colors: colors
        };
        var savedBoard = new Board();
        savedBoard.save(board, {
          success: function (object) {
            console.log(object);
            var div = $('#saveresults');
            div.empty();
            div.append('Saved with id ' + object.id);
          },
          error: function (model, error) {
            var div = $('#saveresults');
            div.empty();
            div.append('There was an error saving: ' + error);
          }
        });
        return false;
      }

    </script>
    <style>
    td {
      border: 1px solid black;
      height: 100px;
    }
    </style>
  </head>
  <body>
    Give me a new grid that is
    <form onSubmit="return handleReset(event)">
      <input type="text" name="width" value="5" />
      by
      <input type="text" name="height" value="3" />
      <input name="Submit"  type="submit" value="Reset" />
    </form>
    <table style="width:100%" id="thetable">
    </table>
    <form onsubmit="return saveBoard(event)">
      <input name="Submit" type="submit" value="Save" />
    </form>
    <div id="saveresults">
    </div>
  </body>
</html>
